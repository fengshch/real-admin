<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password</title>
    <!-- jQuery -->
    <script src="/webjars/jquery/3.7.1/jquery.min.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/webjars/bootstrap/5.3.3/css/bootstrap.min.css">
    <!-- Bootstrap JS -->
    <script src="/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="/static/assets/css/styles.css"/>
</head>
<body>
<div class="wrapper">
    <div id="messageContainer" class="message-container" style="display: none;"></div>
    <div class="container">
        <div class="card">
            <div class="card-header bg-transparent border-bottom-0">
                <h2 class="card-title">Forgot Password</h2>
                <p class="card-description">Enter your email to reset your password</p>
            </div>
            <div class="card-content">
                <form id="forgotPasswordForm">
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                        <div class="invalid-feedback"></div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mt-3">Send Reset Link</button>
                </form>
                <p class="mt-6 text-center text-sm text-muted-foreground">
                    Remember your password? <a href="/login" class="font-medium text-primary">Login here</a>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        function validateForm(formData) {
            let isValid = true;

            // Validate email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(formData.email)) {
                showError('#email', 'Please enter a valid email address');
                isValid = false;
            } else {
                clearError('#email');
            }

            return isValid;
        }

        function showError(selector, message) {
            $(selector).addClass('is-invalid');
            $(selector).siblings('.invalid-feedback').text(message);
        }

        function clearError(selector) {
            $(selector).removeClass('is-invalid');
            $(selector).siblings('.invalid-feedback').text('');
        }

        function handleSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);

            if (validateForm(data)) {
                $.ajax({
                    url: '/api/forgot-password',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function(result) {
                        showMessage('Password reset link sent to your email.', 'success');
                        form.reset();
                        $(form).find('.is-invalid').removeClass('is-invalid');
                        $(form).find('.is-valid').removeClass('is-valid');
                    },
                    error: function(xhr) {
                        const errorData = JSON.parse(xhr.responseText);
                        showMessage(errorData.message || 'An error occurred. Please try again.', 'error');
                    }
                });
            }
        }

        function showMessage(message, type)
        {
            const messageContainer = $('#messageContainer');
            messageContainer.removeClass('success error').addClass(type);
            messageContainer.text(message);
            messageContainer.show();

            // Hide the message after 5 seconds
            setTimeout(() => {
                messageContainer.hide();
            }, 5000);
        }

        $('#forgotPasswordForm').on('submit', handleSubmit);
    });
</script>
</body>
</html>